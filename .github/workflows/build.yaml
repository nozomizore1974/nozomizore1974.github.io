name: Deploy Hugo Website

# 触发条件
on:
  push:
    branches:
      - main  # 当代码推送到 main 分支时触发
  workflow_dispatch:  # 允许从 Actions 手动触发

# 权限配置
permissions:
  contents: read  # 读取代码库内容
  pages: write  # 写入 GitHub Pages
  id-token: write  # 用于身份验证

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest  # 使用最新版本的 Ubuntu 运行环境
    steps:
      # 检出代码库
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 获取完整历史记录，支持 Hugo 的 .GitInfo 和 .Lastmod

      # 设置 Hugo 环境
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: '0.125.7'  # 指定 Hugo 版本
          extended: true  # 启用 SCSS 支持

      # 构建网站
      - name: Build Hugo site
        env:
          HUGO_ENVIRONMENT: production  # 设置为生产环境
        run: |
          hugo --minify --destination public  # 构建 Hugo 网站，输出到 ./public 目录
          echo "Hugo build completed."

      # 配置 Pages 环境
      - name: Setup GitHub Pages
        id: pages
        uses: actions/configure-pages@v5

      # 上传生成的静态网站文件
      - name: Upload website files
        uses: actions/upload-pages-artifact@v3
        with:
          path: public  # 上传 ./public 目录

      # 部署到 GitHub Pages
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
